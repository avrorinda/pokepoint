# Шпаргалка по проекту (Pokemon / Pokepoint)

Короткие напоминания, чтобы «помнить как всё устроено».

## Деплой на GitHub Pages
- CI: файл воркфлоу — `.github/workflows/gh-pages.yml`.
- Ветвь: `main` → Actions → build → deploy в ветку `gh-pages`.
- Требования:
  - В репозитории присутствуют `go.mod`, `go.sum` и каталог `_vendor/` (вендорим Hugo-модули).
  - В настройках репозитория GitHub Pages: Source = GitHub Actions.
- Что делает пайплайн:
  1) Checkout кода (история нужна для генерации sitemap/lastmod).
  2) Устанавливает Go и Hugo (extended).
  3) `hugo mod tidy` (синхронизация модулей) и сборка `hugo --minify`.
  4) Публикация содержимого `public/` в `gh-pages`.

## Обновление темы и модулей (vendor)
- Тема подключена как Hugo Module: `github.com/nicokaiser/hugo-theme-gallery/v4`.
- Используем vendor-режим, чтобы сборка в CI не зависела от сети.
- Процедура обновления локально:
  1) Обновить версию в `go.mod` (или выполнить `hugo mod get -u` для обновлений).
  2) Выполнить:
     - `hugo mod tidy`
     - `hugo mod vendor`
  3) Закоммитить изменения: `go.mod`, `go.sum`, каталог `_vendor/`.
  4) Запустить Actions — убедиться, что сборка зелёная.

## Конфигурация Hugo
- Основной конфиг: `config/_default/hugo.toml`.
- Важные параметры:
  - `baseURL = "https://pokepoint.ru/"` (обновить при смене домена/окружения).
  - `[module] vendorDir = "_vendor"` — хранит модули в репозитории.

## Цены при клике на изображение
- Публичный JSON для фронтенда: `static/data/prices.json` (доступен по `/data/prices.json`).
- Структура: массив объектов `{ "filename": "имя-файла.jpg", "price": 1000 }`.
- Сопоставление происходит по имени файла без хешей Hugo и без учёта регистра:
  - Hugo добавляет к обработанным изображениям суффикс `_hu_...`. Скрипт отрезает его.
  - Ленивая загрузка: если у картинки есть `data-src`, скрипт берёт именно его, иначе `src`.
  - Все ключи и искомые имена приводятся к нижнему регистру.
- Скрипт: `static/js/show-price.js` подключён в переопределённом `layouts/partials/footer.html`.
- Как обновить цены:
  - Редактировать `static/data/prices.json` (и при желании дубликат в `data/prices.json`).
  - Рекомендуется хранить имена файлов в нижнем регистре.

## Локальная проверка
- Запуск локального сервера:
  - `hugo server -D`
- Сборка (перед коммитом/релизом):
  - `hugo --minify`
- Быстрый чек фронтенда:
  - Открыть галерею, кликнуть на изображение — должно показаться alert с ценой.

## Частые проблемы и решения
- 404 для `/data/prices.json`:
  - Убедиться, что файл лежит в `static/data/prices.json` (а не только в `data/`).
- Цена «не найдена» при клике:
  - Проверьте фактическое `src`/`data-src` изображения в DevTools, сравните имя с ключом в JSON.
  - Убедитесь, что в JSON имя в нижнем регистре и без суффикса `_hu_...`.
- CI падает из-за модулей:
  - Проверьте, что закоммичен `_vendor/`, и не игнорируются `go.mod`, `go.sum`.
  - Локально выполните `hugo mod tidy && hugo mod vendor`, затем закоммитьте изменения.

## Где что лежит
- Цены: `static/data/prices.json`
- Скрипт цен: `static/js/show-price.js`
- Подключение скрипта: `layouts/partials/footer.html`
- Конфиг Hugo: `config/_default/hugo.toml`
- CI workflow: `.github/workflows/gh-pages.yml`
- Вендорные модули: `_vendor/`
